"use strict";var _document$querySelect,FREE_DELIVERY=1500;function showCounter(t){t.querySelector('[tagId="productCardButton"]')&&(t.querySelector('[tagId="productCardButton"]').classList.add("button_hidden"),t.querySelector('[tagId="productCardRemoveButton"]').classList.remove("button_hidden"),t.querySelector('[tagId="productCardAddButton"]').classList.remove("button_hidden"))}function hideCounter(t){t.querySelector('[tagId="productCardButton"]')&&(t.querySelector('[tagId="productCardButton"]').classList.remove("button_hidden"),t.querySelector('[tagId="productCardRemoveButton"]').classList.add("button_hidden"),t.querySelector('[tagId="productCardAddButton"]').classList.add("button_hidden"))}function getBasket(){var t=localStorage.getItem("basket");return t?JSON.parse(t):[]}function setBasket(t){localStorage.setItem("basket",JSON.stringify(t))}function changeBasketButtonCount(t){var e=document.querySelector("#amountItemsInBucket");"inc"===t?e.innerText=Number(e.innerText)+1:"dec"===t&&(e.innerText=Number(e.innerText)-1)}function setCardPrice(t,e){t.querySelector('[tagId="productCardPrice"]').innerText=e+" ₽"}function createCardLabel(t){var e=document.createElement("div");return e.classList.add("product-card__label"),e.setAttribute("tagId","counterLabel"),e.innerText=t,e}function setCardLabelValue(t,e){t.querySelector('[tagId="counterLabel"]').innerText=e}function createProductObject(t){return{name:t.querySelector('[tagId="productCardTitle"]').innerText,description:t.querySelector('[tagId="productCardDescription"]').innerText,img:t.querySelector('[tagId="productCardImg"]').getAttribute("src"),weight:parseInt(t.querySelector('[tagId="productCardWeight"]').innerText.slice(5)),price:parseInt(t.querySelector('[tagId="productCardPrice"]').innerText),id:t.getAttribute("dataId")}}function canDo(t){return t.target.closest('[tagId="productCardAddButton"]')||t.target.closest('[tagId="productCardRemoveButton"]')||t.target.closest('[tagId="productCardButton"]')||t.target.closest('[tagId="productCardLink"]')||t.target.closest('[tagId="removeFromBasketButton"]')}function handleLinkClick(t){localStorage.setItem("currentProduct",JSON.stringify(createProductObject(t))),window.open("/product.html","_self")}function handleAddProduct(t){var e=getBasket(),r=createProductObject(t);e.push({product:r,count:1}),changeBasketButtonCount("inc"),t.append(createCardLabel(1)),showCounter(t),setBasket(e)}function handleChangeProductAmount(t,e){var r,c=getBasket(),a=t.getAttribute("dataId"),o=c.findIndex(function(t){return a===t.product.id}),d=c[o],n=d.product.price*d.count;switch(e){case"+":setCardPrice(t,n+d.product.price),d.count+=1,setCardLabelValue(t,d.count),"/basket.html"!==location.pathname||(r=t.querySelector('[tagId="productCardRemoveButton"]')).getAttribute("disabled")&&r.removeAttribute("disabled");break;case"-":1<d.count?(setCardPrice(t,n-d.product.price),--d.count,setCardLabelValue(t,d.count),"/basket.html"===location.pathname&&d.count<=1&&t.querySelector('[tagId="productCardRemoveButton"]').setAttribute("disabled","true")):(t.querySelector(".product-card__label").remove(),c.splice(o,1),hideCounter(t),changeBasketButtonCount("dec"));break;default:return}setBasket(c),"/basket.html"===location.pathname&&setSumPrice(),calcNumberOfProducts(),calcFreeDeliverySum()}function removeFromBasket(e){var t,r,c=getBasket(),a=c.findIndex(function(t){return t.product.id===e.getAttribute("dataId")}),a=(c.splice(a,1),setBasket(c),setSumPrice(),calcNumberOfProducts(),calcFreeDeliverySum(),JSON.parse(localStorage.getItem("addToOrder")));a&&-1!==(c=a.findIndex(function(t){return t.id===e.getAttribute("dataId")}))&&(t=a[c],(r=document.createElement("div")).classList.add("add-to-order__item"),r.setAttribute("dataId",t.id),r.setAttribute("dataDescription",t.description),r.setAttribute("dataWeight",t.weight),r.innerHTML='\n                <img class="add-to-order__img" src="'.concat(t.img,'" alt="').concat(t.name,'">\n                <div class="add-to-order__title">').concat(t.name,'</div> \n                <div class="add-to-order__text-block">\n                    <span class="add-to-order__text">Добавить</span> \n                    <button class="button add-to-order__add-button add-to-order__add-button-counter"></button>\n                </div>\n                <div class="add-to-order__price">').concat(t.price," ₽</div> \n            "),document.querySelector(".add-to-order__items-block").append(r),a.splice(c,1),localStorage.setItem("addToOrder",JSON.stringify(a))),e.remove(),changeBasketButtonCount("dec")}function handleCardClick(t){var e;t.preventDefault(),canDo(t)&&(e=t.target.closest('[tagId="productCard"]'),t.target.closest('[tagId="productCardLink"]')&&handleLinkClick(e),t.target.closest('[tagId="productCardButton"]')&&handleAddProduct(e),t.target.closest('[tagId="productCardAddButton"]')&&handleChangeProductAmount(e,"+"),t.target.closest('[tagId="productCardRemoveButton"]')&&handleChangeProductAmount(e,"-"),t.target.closest('[tagId="removeFromBasketButton"]')&&removeFromBasket(e))}function initBasket(){var t=getBasket();t.length&&(document.querySelector("#amountItemsInBucket").innerText=t.length,"/basket.html"!==location.pathname&&t.forEach(function(t){var e=document.querySelector('[dataId="'.concat(t.product.id,'"]'));e&&(showCounter(e),e.append(createCardLabel(t.count)),setCardPrice(e,t.product.price*t.count))}))}function calcSumPrice(){return getBasket().reduce(function(t,e){return t+=e.product.price*e.count},0)}function setSumPrice(){document.querySelector(".ordering-block__sum-price").innerHTML=" ".concat(calcSumPrice()," ₽")}function calcFreeDeliverySum(){var t=calcSumPrice(),e=document.querySelector('[dataId="freeDelivery"]'),r=document.querySelector(".ordering-block__check-for-discount");FREE_DELIVERY<=t?e.classList.add("ordering-block__free-delivery_hidden"):(null!=(e=e.classList)&&e.remove("ordering-block__free-delivery_hidden"),r.innerHTML=" ".concat(FREE_DELIVERY-t," ₽"))}function calcNumberOfProducts(){var t=getBasket().reduce(function(t,e){return t+=e.count},0);document.querySelector(".basket-page-items-counter").innerHTML="(в корзине ".concat(t," товара)")}null!=(_document$querySelect=document.querySelector('[tagId="cardsSection"]'))&&_document$querySelect.addEventListener("click",handleCardClick),initBasket(),window.basketAPI={changeBasketButtonCount:changeBasketButtonCount,getBasket:getBasket,setBasket:setBasket,setSumPrice:setSumPrice,calcNumberOfProducts:calcNumberOfProducts,calcFreeDeliverySum:calcFreeDeliverySum};